!function(){"use strict";try{self["workbox:sw:6.1.5"]&&_()}catch(o){}const o={backgroundSync:"background-sync",broadcastUpdate:"broadcast-update",cacheableResponse:"cacheable-response",core:"core",expiration:"expiration",googleAnalytics:"offline-ga",navigationPreload:"navigation-preload",precaching:"precaching",rangeRequests:"range-requests",routing:"routing",strategies:"strategies",streams:"streams",recipes:"recipes"};self.workbox=new class{constructor(){return this.v={},this.Pt={debug:"localhost"===self.location.hostname,modulePathPrefix:null,modulePathCb:null},this.$t=this.Pt.debug?"dev":"prod",this.jt=!1,new Proxy(this,{get(e,t){if(e[t])return e[t];var n=o[t];return n&&e.loadModule("workbox-"+n),e[t]}})}setConfig(e={}){if(this.jt)throw new Error("Config must be set before accessing workbox.* modules");Object.assign(this.Pt,e),this.$t=this.Pt.debug?"dev":"prod"}loadModule(t){var n=this.St(t);try{importScripts(n),this.jt=!0}catch(e){throw console.error(`Unable to import module '${t}' from '${n}'.`),e}}St(e){if(this.Pt.modulePathCb)return this.Pt.modulePathCb(e,this.Pt.debug);let t=["https://storage.googleapis.com/workbox-cdn/releases/6.1.5"];const n=`${e}.${this.$t}.js`,o=this.Pt.modulePathPrefix;return o&&(t=o.split("/"),""===t[t.length-1]&&t.splice(t.length-1,1)),t.push(n),t.join("/")}}}();var idb=function(e){"use strict";let r,s;const a=new WeakMap,c=new WeakMap,l=new WeakMap,n=new WeakMap,o=new WeakMap;let d={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return c.get(e);if("objectStoreNames"===t)return e.objectStoreNames||l.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return u(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function i(e){return"function"==typeof e?(n=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s=s||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(n)?function(...e){return n.apply(g(this),e),u(a.get(this))}:function(...e){return u(n.apply(g(this),e))}:function(e,...t){t=n.call(g(this),e,...t);return l.set(t,e.sort?e.sort():[e]),u(t)}:(e instanceof IDBTransaction&&(i=e,c.has(i)||(t=new Promise((e,t)=>{const n=()=>{i.removeEventListener("complete",o),i.removeEventListener("error",r),i.removeEventListener("abort",r)},o=()=>{e(),n()},r=()=>{t(i.error||new DOMException("AbortError","AbortError")),n()};i.addEventListener("complete",o),i.addEventListener("error",r),i.addEventListener("abort",r)}),c.set(i,t))),o=e,(r=r||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]).some(e=>o instanceof e)?new Proxy(e,d):e);var i,t,n,o}function u(e){if(e instanceof IDBRequest)return function(i){const e=new Promise((e,t)=>{const n=()=>{i.removeEventListener("success",o),i.removeEventListener("error",r)},o=()=>{e(u(i.result)),n()},r=()=>{t(i.error),n()};i.addEventListener("success",o),i.addEventListener("error",r)});return e.then(e=>{e instanceof IDBCursor&&a.set(e,i)}).catch(()=>{}),o.set(e,i),e}(e);if(n.has(e))return n.get(e);var t=i(e);return t!==e&&(n.set(e,t),o.set(t,e)),t}const g=e=>o.get(e),p=["get","getKey","getAll","getAllKeys","count"],f=["put","add","delete","clear"],b=new Map;function h(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(b.get(t))return b.get(t);const o=t.replace(/FromIndex$/,""),r=t!==o,i=f.includes(o);if(o in(r?IDBIndex:IDBObjectStore).prototype&&(i||p.includes(o))){e=async function(e,...t){e=this.transaction(e,i?"readwrite":"readonly");let n=e.store;return r&&(n=n.index(t.shift())),(await Promise.all([n[o](...t),i&&e.done]))[0]};return b.set(t,e),e}}}return d={...m=d,get:(e,t,n)=>h(e,t)||m.get(e,t,n),has:(e,t)=>!!h(e,t)||m.has(e,t)},e.deleteDB=function(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),u(n).then(()=>{})},e.openDB=function(e,t,{blocked:n,upgrade:o,blocking:r,terminated:i}={}){const s=indexedDB.open(e,t),a=u(s);return o&&s.addEventListener("upgradeneeded",e=>{o(u(s.result),e.oldVersion,e.newVersion,u(s.transaction))}),n&&s.addEventListener("blocked",()=>n()),a.then(e=>{i&&e.addEventListener("close",()=>i()),r&&e.addEventListener("versionchange",()=>r())}).catch(()=>{}),a},e.unwrap=g,e.wrap=u,e;var m}({});const SERVER_DOMAIN="https://us-central1-pwa-demo-nil1729.cloudfunctions.net",GEOCODING_API_URL="https://us1.locationiq.com/v1/reverse.php",vapidPublicKey="BP4PlsYeQd4Wg6Mqn-o48s6mtktxM2EexAHHBVzplZqUUt8BSooje8UcRnmcAKhPBC6ETLlx21-MiX2yYu9UUnw",GEOCODING_API_KEY="pk.7b5b75ce36499da797a396dac9a449cc",dbPromise=idb.openDB("Posts",1,{upgrade(e){e.objectStoreNames.contains("feed-posts")||e.createObjectStore("feed-posts",{keyPath:"id"}),!e.objectStoreNames.contains("sync-posts")&&window.SyncManager&&e.createObjectStore("sync-posts",{keyPath:"id"})}});function writeData(o,r){return dbPromise.then(function(e){const t=e.transaction(o,"readwrite"),n=t.objectStore(o);return n.put(r),t.done})}function readData(n){return dbPromise.then(function(e){const t=e.transaction(n,"readonly").objectStore(n);return t.getAll()})}function clearStore(o){return dbPromise.then(function(e){const t=e.transaction(o,"readwrite"),n=t.objectStore(o);return n.clear(),t.done})}function clearItemFromStore(o,r){dbPromise.then(function(e){const t=e.transaction(o,"readwrite"),n=t.objectStore(o);return n.delete(r),t.done}).then(function(){console.log("Item Deleted!")})}function urlBase64ToUint8Array(e){for(var e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(e),n=new Uint8Array(t.length),o=0;o<t.length;++o)n[o]=t.charCodeAt(o);return n}function dataURItoBlob(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],e=new ArrayBuffer(t.length),o=new Uint8Array(e),r=0;r<t.length;r++)o[r]=t.charCodeAt(r);return new Blob([e],{type:n})}const FALLBACK_HTML_URL="/offline.html",FALLBACK_IMAGE_URL="/src/images/offline.jpg";self.skipWaiting(),self.addEventListener("activate",e=>{self.clients.claim()}),workbox.navigationPreload.isSupported()&&workbox.navigationPreload.enable(),workbox.precaching.precacheAndRoute([{revision:"2cab47d9e04d664d93c8d91aec59e812",url:"favicon.ico"},{revision:"794697a86df2b2bd97cbeb3c6c2a234c",url:"index.html"},{revision:"92b2c8e54007ca32af0b9efe5d0455bb",url:"manifest.json"},{revision:"0a4b356a0a6d0d5614ce11f0b77f60bb",url:"offline.html"},{revision:"26719f404eef804028ddda347c8efc26",url:"src/css/app.css"},{revision:"435e31a13d5e089c704b268b1a38db43",url:"src/css/help.css"},{revision:"3d8bcee9c08272304c8ccd642e141196",url:"src/css/main.css"},{revision:"84c568338e0d6fd0e728fdac08b2aefd",url:"src/images/main-bg.jpg"},{revision:"73898b781627214e1df133f6474bf13d",url:"src/images/offline.jpg"},{revision:"0599b8078922f6d23b47b097a796671d",url:"src/js/app.min.js"},{revision:"e954fba0b8068988f556fc7adbadba88",url:"src/js/feed.min.js"},{revision:"713af0c6ce93dbbce2f00bf0a98d0541",url:"src/js/material.min.js"},{revision:"83011e228238e66949f0aa0f28f128ef",url:"src/images/icons/app-icon-144x144.png"}]),workbox.routing.registerRoute(({url:e})=>"https://fonts.googleapis.com"===e.origin||"https://fonts.gstatic.com"===e.origin,new workbox.strategies.StaleWhileRevalidate({cacheName:"google-fonts",plugins:[new workbox.expiration.ExpirationPlugin({maxAgeSeconds:2592e3})]})),workbox.routing.registerRoute(({request:e,url:t})=>"image"===e.destination&&"https://storage.googleapis.com"===t.origin,new workbox.strategies.CacheFirst({cacheName:"post-images",plugins:[new workbox.expiration.ExpirationPlugin({maxAgeSeconds:604800,maxEntries:5}),new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]})]})),workbox.routing.registerRoute("https://code.getmdl.io/1.3.0/material.indigo-pink.min.css",new workbox.strategies.StaleWhileRevalidate({cacheName:"material-css",plugins:[new workbox.expiration.ExpirationPlugin({maxAgeSeconds:2592e3,maxEntries:1})]})),workbox.routing.registerRoute(`${SERVER_DOMAIN}/getPosts`,async function(e){return fetch(e.request).then(function(e){const t=e.clone();return clearStore("feed-posts").then(function(){return t.json()}).then(function(e){for(var t in e)writeData("feed-posts",e[t])}),e})}),workbox.routing.registerRoute(({request:e})=>"navigate"===e.mode,async function({event:e}){return fetch(e.request).catch(function(){return workbox.precaching.matchPrecache(FALLBACK_HTML_URL)})}),workbox.routing.setCatchHandler(async({event:e})=>"image"!==e.request.destination?Response.error():workbox.precaching.matchPrecache(FALLBACK_IMAGE_URL));const bgSyncPluginForSendingPost=new workbox.backgroundSync.BackgroundSyncPlugin("syncing-post",{maxRetentionTime:1440});workbox.routing.registerRoute(`${SERVER_DOMAIN}/savePost`,new workbox.strategies.NetworkOnly({plugins:[bgSyncPluginForSendingPost]}),"POST"),self.addEventListener("notificationclick",function(e){console.log("[Service Worker] Notification Clicked",e);let n=e.notification;"open"===e.action?e.waitUntil(clients.matchAll().then(function(e){let t=e.find(function(e){return"visible"===e.visibilityState});t?(t.navigate(n.data.url),t.focus()):clients.openWindow(n.data.url),n.close()})):n.close()}),self.addEventListener("notificationclose",function(e){console.log("[Service Worker] Notification Closed",e)}),self.addEventListener("push",function(e){console.log("[Service Worker] Push Notification received",e);let t={title:"New Post",content:"New post added to PWAGram",postPhoto:"/src/images/main-bg.jpg",openURL:"/"};e.data&&(t=JSON.parse(e.data.text()));var n={body:t.content,icon:"/src/images/icons/app-icon-96x96.png",image:t.postPhoto,dir:"ltr",lang:"en-US",vibrate:[100,50,200],badge:"/src/images/icons/app-icon-96x96.png",tag:"new-post-notification",renotify:!1,actions:[{action:"open",title:"Open Post",icon:"/src/images/icons/open.png"},{action:"close",title:"Close",icon:"/src/images/icons/close.png"}],data:{url:t.openURL}};e.waitUntil(self.registration.showNotification(t.title,n))});